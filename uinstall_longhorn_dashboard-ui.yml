# uinstall_longhorn_dashboard-ui.yml
---
# ðŸ§¹ DesinstalaciÃ³n de recursos del Dashboard de Longhorn

- name: ðŸ§¹ Desinstalar IngressRoute, Middleware y Secret de Longhorn
  hosts: localhost
  gather_facts: false
  vars_files:
    - vars/main.yml

  vars:
    files_dir: "{{ playbook_dir }}/files"
    sealed_secret_name: "{{ secret_name }}"
    namespace: "{{ longhorn_namespace }}"
    ingressroute_name: "ingressroute-longhorn-internal"
    middleware_name_to_delete: "{{ middleware_name }}"

  tasks:
    - name: âŒ Eliminar IngressRoute del Dashboard
      command: >
        {{ kubectl_path }} --kubeconfig {{ kubeconfig_path }}
        delete ingressroute {{ ingressroute_name }} -n {{ namespace }}
      ignore_errors: true

    - name: âŒ Eliminar Middleware de autenticaciÃ³n
      command: >
        {{ kubectl_path }} --kubeconfig {{ kubeconfig_path }}
        delete middleware {{ middleware_name_to_delete }} -n {{ namespace }}
      ignore_errors: true

    - name: âŒ Eliminar SealedSecret del Dashboard
      command: >
        {{ kubectl_path }} --kubeconfig {{ kubeconfig_path }}
        delete sealedsecret {{ sealed_secret_name }} -n {{ namespace }}
      ignore_errors: true

    - name: ðŸ§¹ Eliminar archivos locales renderizados
      file:
        path: "{{ item }}"
        state: absent
      loop:
        - "{{ files_dir }}/longhorn-dashboard-auth.yaml"
        - "{{ files_dir }}/longhorn-dashboard-ingressroute.yaml"
        - "{{ files_dir }}/longhorn-dashboard-secret.yaml"
        - "{{ files_dir }}/longhorn-dashboard-sealed.yaml"
      ignore_errors: true